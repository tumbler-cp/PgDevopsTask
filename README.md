## Ходжаев Абдужалол Абдужаборович  

# Описание  

Консольное приложение, которое устанавливает PostgreSQL на удалённый хост, выполняет его настройку, запуск и проверку работоспособности. Решение построено на связке Python + Ansible.

Приложение выполняет следующие шаги:  
- Оценка загруженности серверов с помощью Ansible.  
- Выбор целевого хоста для установки PostgreSQL на основании загруженности (логика на Python).  
- Установка PostgreSQL на выбранный сервер с помощью Ansible.  
- Конфигурация PostgreSQL: настройка пользователя `student` с ограничением подключения только с IP-адреса второго сервера (Ansible).  
- Проверка работоспособности установленной СУБД простым SQL-запросом `SELECT 1` (Ansible).  

**Допущения:**  
- SSH-ключ для подключения к серверам уже добавлен и доступен по стандартному пути `~/.ssh/...`.  
- Оценка загруженности производится только по параметрам процессора и оперативной памяти.  
- Пользователь не удалил Ansible playbook-и, поставляемые вместе со скриптом.

# Инструкция по запуску  

Запуск приложения осуществляется с помощью команды, где необходимо указать IP-адреса серверов одной строкой, разделённых запятой:

```bash
./main.py <IP-адрес Debian-сервера>,<IP-адрес Almalinux/CentOS-сервера>
```

# Тестовое окружение  

В папке `vagrant` этого репозитория находится `Vagrantfile` с конфигурацией двух виртуальных машин:  
- Debian  
- Almalinux  

Запуск виртуальных машин выполняется командой:  

```bash
vagrant up
```

# Вопросы и решения  

1. **Какой дистрибутив выбрать для второго сервера в тестовом окружении?**  
   **Решение:** Был выбран Almalinux, так как актуальные образы CentOS представляют собой rolling-release версии (например, CentOS 9 или 10), что может повлиять на стабильность.

2. **Насколько глубокой должна быть конфигурация приложения?**  
   **Решение:** Решено ограничиться минимально необходимыми настройками согласно ТЗ: передача IP-адресов одной строкой с разделителем запятая. Предполагается, что SSH-ключ пользователя находится в стандартном пути.

3. **Как должна происходить оценка загруженности серверов?**  
   **Решение:** Оценка производится по двум ключевым метрикам:  
   - загрузка процессора,  
   - использование оперативной памяти.  

   Для расчёта итогового показателя применяется взвешенная формула, где больший вес отдан загрузке процессора. Измерение выполняется через Ansible с использованием стандартных утилит `top` и `free`.  
   Первоначально планировалось добавить также учёт заполненности дисков, но было решено, что этот параметр не оказывает значимого влияния на выбор сервера под установку PostgreSQL.

4. **Формат сообщений статуса сообщений.**  
   **Решение:** Логгер + сопровождающие сообщения.

# Дополнения
- Этап конфигурации выполняется согласно ТЗ, однако нет уверенности в настройке подключения пользователья student, так как не было проверки.
- Файл с заданием решил не приложить, так как это секретные данные.